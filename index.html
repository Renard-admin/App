<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –õ–µ—Ç–Ω–∏–π –û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä</title>
    <!-- Tailwind CSS CDN –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç Inter –¥–ª—è –≤—Å–µ–≥–æ —Ç–µ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –®—É–ª—å—Ç–µ */
        .schulte-grid {
            display: grid;
            gap: 4px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind gap-1 */
            background-color: #374151; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind gray-700 */
            padding: 8px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind p-2 */
            border-radius: 8px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind shadow-lg */
            border: 2px solid #b45309; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind border-amber-700 */
        }
        .schulte-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind p-2 */
            border-radius: 6px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind rounded-md */
            font-weight: bold; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind font-bold */
            font-size: 1.25rem; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind text-xl */
            cursor: pointer;
            transition: all 100ms ease-in-out;
            background-color: #1f2937; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind gray-800 */
            color: #fcd34d; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind amber-300 */
            width: 100%;
            padding-bottom: 100%; /* –î–µ–ª–∞–µ—Ç —è—á–µ–π–∫–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ */
            position: relative;
        }
        .schulte-cell span {
            position: absolute; /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤–Ω—É—Ç—Ä–∏ —è—á–µ–π–∫–∏ */
        }
        .schulte-cell:hover {
            background-color: #4b5563; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind hover:bg-gray-600 */
        }
        .schulte-cell.found {
            background-color: #047857; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Tailwind bg-green-700 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω, –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ JS -->
    <div id="message-modal-container"></div>
    <div id="ai-modal-container"></div>

    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border-2 border-amber-700 w-full max-w-md text-center">
            <h2 class="text-3xl font-bold text-amber-400 mb-6">–í—Ö–æ–¥</h2>
            <div class="mb-4">
                <input
                    type="text"
                    id="login-username"
                    placeholder="–õ–æ–≥–∏–Ω"
                    class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                />
            </div>
            <div class="mb-6">
                <input
                    type="password"
                    id="login-password"
                    placeholder="–ü–∞—Ä–æ–ª—å"
                    class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                />
            </div>
            <button
                id="login-button"
                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 w-full"
            >
                –í–æ–π—Ç–∏
            </button>
            <p id="login-error-message" class="text-red-400 mt-4 hidden">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.</p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="main-app-content" class="min-h-screen flex flex-col items-center p-4 sm:p-6 hidden">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="w-full max-w-6xl text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-amber-500 mb-2 drop-shadow-lg">
                –ú–æ–π –õ–µ—Ç–Ω–∏–π –û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä
            </h1>
            <p id="user-id-display" class="text-sm text-gray-400 mt-2 hidden">
                ID –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span class="font-mono break-all" id="user-id-value"></span>
            </p>
            <p class="text-sm text-gray-400">
                –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <span class="font-semibold text-amber-300" id="logged-in-username-display"></span>
            </p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
        <div id="nav-tabs" class="w-full max-w-6xl flex flex-wrap justify-center gap-2 mb-8 bg-gray-800 rounded-full p-1 shadow-inner">
            <!-- –ö–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é JS -->
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
        <div id="content-area" class="w-full max-w-6xl bg-gray-800 p-6 rounded-xl shadow-2xl border-2 border-amber-700">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>

        <!-- –§—É—Ç–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <footer class="mt-8 text-gray-500 text-sm text-center">
            <p>&copy; 2025 –ú–æ–π –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Firebase –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let app;
        let db;
        let auth;
        let currentUserId = null; // Firebase UID
        let loggedInUsername = null; // –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Renard, Ilsiya –∏ —Ç.–¥.)
        let isAuthReady = false;

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π (–∑–∞–º–µ–Ω–∞ alert())
        function showMessageModal(message, onClose) {
            const container = document.getElementById('message-modal-container');
            container.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-sm w-full text-center border-2 border-amber-500">
                        <p class="text-lg mb-4">${message}</p>
                        <button id="message-modal-close" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out transform hover:scale-105">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('message-modal-close').onclick = () => {
                container.innerHTML = '';
                if (onClose) onClose();
            };
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function showAIModal(title, content, isLoading, onClose) {
            const container = document.getElementById('ai-modal-container');
            container.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-lg w-full text-center border-2 border-amber-500 relative">
                        <h3 class="text-2xl font-bold text-amber-400 mb-4">${title}</h3>
                        ${isLoading ? `
                            <div class="flex justify-center items-center h-24">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"></div>
                                <p class="ml-4 text-gray-300">AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç...</p>
                            </div>
                        ` : `
                            <p class="text-lg mb-4 text-left whitespace-pre-wrap">${content}</p>
                        `}
                        <button id="ai-modal-close" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out transform hover:scale-105 mt-4">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('ai-modal-close').onclick = () => {
                container.innerHTML = '';
                if (onClose) onClose();
            };
        }

        // –ò–∫–æ–Ω–∫–∏ (SVG –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏)
        const icons = {
            ScheduleIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`,
            ShoppingCartIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>`,
            TargetIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
            BananaIcon: `<span class="text-2xl mr-2">üçå</span>`,
            BrainIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M12 12c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"></path><path d="M12 12c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z"></path><path d="M12 12c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"></path><path d="M12 12c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6-6z"></path></svg>`,
            FamilyIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M16 17a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle><path d="M18 22v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle><path d="M20 22v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
            HabitsIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14 9 11"></polyline></svg>`,
            LearningIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20V6.5A2.5 2.5 0 0 0 17.5 4h-11A2.5 2.5 0 0 0 4 6.5v13z"></path><path d="M12 10.5V17"></path><path d="M9.5 14.5L12 17l2.5-2.5"></path></svg>`,
            FinanceIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
            GamepadIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M6 10H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M18 10h2a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2"></path><path d="M10 18v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2"></path><path d="M10 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path><rect x="2" y="6" width="20" height="12" rx="4"></rect><path d="M12 10v4"></path><path d="M14 12H10"></path></svg>`,
            NotebookIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-5 h-5 mr-2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>`,
            DeleteIcon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" class="w-6 h-6"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>`
        };

        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞
        const userCredentials = {
            "Renard": "121212",
            "Ilsiya": "1949",
            "Ramir": "1709",
            "Riana": "7590"
        };

        // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è Renard
        const renardSchedule = {
            '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': [
                { id: 'mon-0730', time: '07:30', activity: '–†–∞–∑–º–∏–Ω–∫–∞ (YouTube: MadFit)', type: 'default' },
                { id: 'mon-0745', time: '07:45', activity: '–ü–ª–∞–≤–∞–Ω–∏–µ', type: 'default' },
                { id: 'mon-0800', time: '08:00', activity: '–î—É—à', type: 'default' },
                { id: 'mon-0815', time: '08:15', activity: '–ó–∞–≤—Ç—Ä–∞–∫ (–∫–∞—à–∞ + —Ñ—Ä—É–∫—Ç—ã)', type: 'default' },
                { id: 'mon-0830', time: '08:30', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è (https://medito.app)', type: 'default' },
                { id: 'mon-0850', time: '08:50', activity: 'qalan (https://khanacademy.org)', type: 'default' },
                { id: 'mon-1030', time: '10:30', activity: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (BBC + Grammarly)', type: 'default' },
                { id: 'mon-1100', time: '11:00', activity: '–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è', type: 'default' },
                { id: 'mon-1200', time: '12:00', activity: '–û–±–µ–¥', type: 'default' },
                { id: 'mon-1300', time: '13:00', activity: 'YouTube —Ä–∞–∑–≤–∏—Ç–∏–µ', type: 'default' },
                { id: 'mon-1400', time: '14:00', activity: '–ß—Ç–µ–Ω–∏–µ ‚Äî ¬´–ú–µ—Å—è—Ü –Ω–∞ –ø—Ä–µ–¥–µ–ª–µ¬ª', type: 'default' },
                { id: 'mon-1500', time: '15:00', activity: '–®–∫–æ–ª—å–Ω—ã–µ —Ç–µ–º—ã (https://resh.edu.ru)', type: 'default' },
                { id: 'mon-1600', time: '16:00', activity: '–û—Ç–¥—ã—Ö', type: 'default' },
                { id: 'mon-1740', time: '17:40', activity: '–ö–∞—á–∞–ª–∫–∞: –ì—Ä—É–¥—å + –±–∏—Ü–µ–ø—Å', type: 'default' },
                { id: 'mon-2130', time: '21:30', activity: '–£–∂–∏–Ω, –¥—É—à', type: 'default' },
                { id: 'mon-2200', time: '22:00', activity: '–†–µ—Ñ–ª–µ–∫—Å–∏—è –≤ Notion', type: 'default' },
                { id: 'mon-2210', time: '22:10', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ —Å–æ–Ω', type: 'default' },
            ],
            '–í—Ç–æ—Ä–Ω–∏–∫': [
                { id: 'tue-0730', time: '07:30', activity: '–†–∞–∑–º–∏–Ω–∫–∞', type: 'default' },
                { id: 'tue-0745', time: '07:45', activity: '–ü–ª–∞–≤–∞–Ω–∏–µ', type: 'default' },
                { id: 'tue-0800', time: '08:00', activity: '–î—É—à', type: 'default' },
                { id: 'tue-0815', time: '08:15', activity: '–ó–∞–≤—Ç—Ä–∞–∫', type: 'default' },
                { id: 'tue-0830', time: '08:30', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', type: 'default' },
                { id: 'tue-0900', time: '09:00', activity: 'qalan', type: 'default' },
                { id: 'tue-1100', time: '11:00', activity: '–ö—É—Ä—Å—ã Morriss (Zoom)', type: 'default' },
                { id: 'tue-1200', time: '12:00', activity: '–û–±–µ–¥', type: 'default' },
                { id: 'tue-1230', time: '12:30', activity: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (https://writeandimprove.com)', type: 'default' },
                { id: 'tue-1330', time: '13:30', activity: '–ß—Ç–µ–Ω–∏–µ', type: 'default' },
                { id: 'tue-1430', time: '14:30', activity: 'YouTube —Ä–∞–∑–≤–∏—Ç–∏–µ', type: 'default' },
                { id: 'tue-1530', time: '15:30', activity: '–ü—Ä–æ–≥—É–ª–∫–∞ / –≤–µ–ª–∏–∫', type: 'default' },
                { id: 'tue-1600', time: '16:00', activity: '–®–∫–æ–ª—å–Ω—ã–µ —Ç–µ–º—ã', type: 'default' },
                { id: 'tue-1730', time: '17:30', activity: '–û—Ç–¥—ã—Ö', type: 'default' },
                { id: 'tue-1930', time: '19:30', activity: '–£–∂–∏–Ω, –¥—É—à', type: 'default' },
                { id: 'tue-2000', time: '20:00', activity: '–†–µ—Ñ–ª–µ–∫—Å–∏—è –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ', type: 'default' },
                { id: 'tue-2100', time: '21:00', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ —Å–æ–Ω', type: 'default' },
            ],
            '–°—É–±–±–æ—Ç–∞': [
                { id: 'sat-0730', time: '07:30', activity: '–†–∞–∑–º–∏–Ω–∫–∞', type: 'default' },
                { id: 'sat-0745', time: '07:45', activity: '–ü–ª–∞–≤–∞–Ω–∏–µ', type: 'default' },
                { id: 'sat-0800', time: '08:00', activity: '–î—É—à', type: 'default' },
                { id: 'sat-0815', time: '08:15', activity: '–ó–∞–≤—Ç—Ä–∞–∫', type: 'default' },
                { id: 'sat-0830', time: '08:30', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', type: 'default' },
                { id: 'sat-0900', time: '09:00', activity: 'qalan', type: 'default' },
                { id: 'sat-1200', time: '12:00', activity: '–ö—É—Ä—Å—ã Morriss', type: 'default' },
                { id: 'sat-1400', time: '14:00', activity: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π Speaking (https://elllo.org)', type: 'default' },
                { id: 'sat-1530', time: '15:30', activity: '–ß—Ç–µ–Ω–∏–µ / —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è', type: 'default' },
                { id: 'sat-1700', time: '17:00', activity: '–ü—Ä–æ–≥—É–ª–∫–∞ —Å –¥—Ä—É–∑—å—è–º–∏', type: 'default' },
                { id: 'sat-1900', time: '19:00', activity: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –±–∞–Ω—è', type: 'default' },
                { id: 'sat-2100', time: '21:00', activity: '–û—Ç–¥—ã—Ö', type: 'default' },
            ],
            '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ': [
                { id: 'sun-0730', time: '07:30', activity: '–†–∞–∑–º–∏–Ω–∫–∞', type: 'default' },
                { id: 'sun-0745', time: '07:45', activity: '–ü–ª–∞–≤–∞–Ω–∏–µ', type: 'default' },
                { id: 'sun-0800', time: '08:00', activity: '–î—É—à', type: 'default' },
                { id: 'sun-0815', time: '08:15', activity: '–ó–∞–≤—Ç—Ä–∞–∫', type: 'default' },
                { id: 'sun-0830', time: '08:30', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', type: 'default' },
                { id: 'sun-0830-2', time: '08:30', activity: '–£–±–æ—Ä–∫–∞ –¥–≤–æ—Ä–∞', type: 'default' },
                { id: 'sun-1030', time: '10:30', activity: '–í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞', type: 'default' },
                { id: 'sun-1130', time: '11:30', activity: '–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —à–∫–æ–ª—å–Ω—ã—Ö —Ç–µ–º', type: 'default' },
                { id: 'sun-1400', time: '14:00', activity: 'FLEX Essay (https://perfect-english-grammar.com)', type: 'default' },
                { id: 'sun-1500', time: '15:00', activity: '–ü—Ä–æ–≥—É–ª–∫–∞', type: 'default' },
                { id: 'sun-1800', time: '18:00', activity: '–í—Ä–µ–º—è —Å —Å–µ–º—å—ë–π', type: 'default' },
                { id: 'sun-2000', time: '20:00', activity: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ —Å–æ–Ω', type: 'default' },
            ],
        };

        // –ö–æ–ø–∏—Ä—É–µ–º –∏ –∏–∑–º–µ–Ω—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –°—Ä–µ–¥—ã, –ß–µ—Ç–≤–µ—Ä–≥–∞ –∏ –ü—è—Ç–Ω–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞/–í—Ç–æ—Ä–Ω–∏–∫–∞
        renardSchedule['–°—Ä–µ–¥–∞'] = JSON.parse(JSON.stringify(renardSchedule['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫']));
        const wednesdayActivity = renardSchedule['–°—Ä–µ–¥–∞'].find(e => e.activity.includes('–ö–∞—á–∞–ª–∫–∞'));
        if (wednesdayActivity) wednesdayActivity.activity = '–ö–∞—á–∞–ª–∫–∞: –°–ø–∏–Ω–∞ + —Ç—Ä–∏—Ü–µ–ø—Å';

        renardSchedule['–ü—è—Ç–Ω–∏—Ü–∞'] = JSON.parse(JSON.stringify(renardSchedule['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫']));
        const fridayActivity = renardSchedule['–ü—è—Ç–Ω–∏—Ü–∞'].find(e => e.activity.includes('–ö–∞—á–∞–ª–∫–∞'));
        if (fridayActivity) fridayActivity.activity = '–ö–∞—á–∞–ª–∫–∞: –ü–ª–µ—á–∏ + –ø—Ä–µ—Å—Å';

        renardSchedule['–ß–µ—Ç–≤–µ—Ä–≥'] = JSON.parse(JSON.stringify(renardSchedule['–í—Ç–æ—Ä–Ω–∏–∫']));

        // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const defaultUserAppData = {
            "Renard": {
                schedule: renardSchedule,
                shoppingList: [],
                goals: [],
                bananaCount: 0,
                familyActivities: [],
                dailyHabits: [],
                learningSubjects: [],
                transactions: [],
                notes: [],
            },
            "Ilsiya": {
                schedule: {},
                shoppingList: [],
                goals: [],
                bananaCount: 0,
                familyActivities: [],
                dailyHabits: [],
                learningSubjects: [],
                transactions: [],
                notes: [],
            },
            "Ramir": {
                schedule: {},
                shoppingList: [],
                goals: [],
                bananaCount: 0,
                familyActivities: [],
                dailyHabits: [],
                learningSubjects: [],
                transactions: [],
                notes: [],
            },
            "Riana": {
                schedule: {},
                shoppingList: [],
                goals: [],
                bananaCount: 0,
                familyActivities: [],
                dailyHabits: [],
                learningSubjects: [],
                transactions: [],
                notes: [],
            }
        };

        // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        let appState = {
            schedule: {},
            shoppingList: [],
            goals: [],
            bananaCount: 0,
            familyActivities: [],
            dailyHabits: [],
            learningSubjects: [],
            transactions: [],
            notes: [],
        };
        let activeTab = 'schedule'; // –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Firestore
        async function saveData(dataToSave) {
            if (db && currentUserId && loggedInUsername) {
                try {
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    // –ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É –ø—Ä–æ—Ñ–∏–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userProfileDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profiles/${loggedInUsername}`);
                    await setDoc(userProfileDocRef, dataToSave, { merge: true });
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", e);
                    showMessageModal("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                }
            } else {
                console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –ª–æ–≥–∏–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.");
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firestore
        function loadData() {
            if (db && currentUserId && loggedInUsername && isAuthReady) {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const userProfileDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profiles/${loggedInUsername}`);

                onSnapshot(userProfileDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        // –û–±–Ω–æ–≤–ª—è–µ–º appState, –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        Object.assign(appState, {
                            schedule: data.schedule || defaultUserAppData[loggedInUsername].schedule,
                            shoppingList: data.shoppingList || [],
                            goals: data.goals || [],
                            bananaCount: data.bananaCount || 0,
                            familyActivities: data.familyActivities || [],
                            dailyHabits: data.dailyHabits || [],
                            learningSubjects: data.learningSubjects || [],
                            transactions: data.transactions || [],
                            notes: data.notes || [],
                        });
                        renderApp(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    } else {
                        // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const initialData = defaultUserAppData[loggedInUsername];
                        setDoc(userProfileDocRef, initialData)
                            .then(() => {
                                Object.assign(appState, initialData);
                                renderApp();
                            })
                            .catch(e => console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", e));
                    }
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firestore:", error);
                    showMessageModal("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.");
                });
            }
        }

        // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ React App.js) ---

        // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        function addEventToSchedule(day, time, activity, type = 'custom') {
            const newEvent = { id: Date.now(), time, activity, type };
            const updatedScheduleDay = [...(appState.schedule[day] || []), newEvent];
            appState.schedule = { ...appState.schedule, [day]: updatedScheduleDay };
            saveData({ schedule: appState.schedule });
            renderScheduleTab(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–∫—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
        }

        function updateScheduleEvent(day, eventId, newActivity) {
            const updatedScheduleDay = (appState.schedule[day] || []).map(event =>
                event.id === eventId ? { ...event, activity: newActivity } : event
            );
            appState.schedule = { ...appState.schedule, [day]: updatedScheduleDay };
            saveData({ schedule: appState.schedule });
            renderScheduleTab();
        }

        function removeScheduleEvent(day, eventId) {
            const updatedScheduleDay = (appState.schedule[day] || []).filter(event => event.id !== eventId);
            appState.schedule = { ...appState.schedule, [day]: updatedScheduleDay };
            saveData({ schedule: appState.schedule });
            renderScheduleTab();
        }

        // –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
        function addShoppingItem(item) {
            const newShoppingList = [...appState.shoppingList, { id: Date.now(), ...item, completed: false }];
            appState.shoppingList = newShoppingList;
            saveData({ shoppingList: newShoppingList });
            renderShoppingTab();
        }
        function toggleShoppingItem(id) {
            const newShoppingList = appState.shoppingList.map(item =>
                item.id === id ? { ...item, completed: !item.completed } : item
            );
            appState.shoppingList = newShoppingList;
            saveData({ shoppingList: newShoppingList });
            renderShoppingTab();
        }
        function removeShoppingItem(id) {
            const newShoppingList = appState.shoppingList.filter(item => item.id !== id);
            appState.shoppingList = newShoppingList;
            saveData({ shoppingList: newShoppingList });
            renderShoppingTab();
        }

        // –¶–µ–ª–∏
        function addGoal(goalText) {
            if (goalText.trim()) {
                const newGoals = [...appState.goals, { id: Date.now(), text: goalText, completed: false }];
                appState.goals = newGoals;
                saveData({ goals: newGoals });
                renderGoalsTab();
            }
        }
        function toggleGoal(id) {
            const newGoals = appState.goals.map(goal =>
                goal.id === id ? { ...goal, completed: !goal.completed } : goal
            );
            appState.goals = newGoals;
            saveData({ goals: newGoals });
            renderGoalsTab();
        }
        function removeGoal(id) {
            const newGoals = appState.goals.filter(goal => goal.id !== id);
            appState.goals = newGoals;
            saveData({ goals: newGoals });
            renderGoalsTab();
        }

        // –°—á–µ—Ç—á–∏–∫ –±–∞–Ω–∞–Ω–æ–≤
        function incrementBanana() {
            appState.bananaCount += 1;
            saveData({ bananaCount: appState.bananaCount });
            renderShoppingTab(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
        }
        function decrementBanana() {
            appState.bananaCount = Math.max(0, appState.bananaCount - 1);
            saveData({ bananaCount: appState.bananaCount });
            renderShoppingTab(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
        }

        // –°–µ–º–µ–π–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        function addFamilyActivity(activity) {
            const newActivities = [...appState.familyActivities, { id: Date.now(), ...activity }];
            appState.familyActivities = newActivities;
            saveData({ familyActivities: newActivities });
            renderFamilyTimeTab();
            addEventToSchedule(activity.day, activity.time, `–°–µ–º—å—è: ${activity.text}`, 'family');
        }
        function removeFamilyActivity(id, day, time, activityText) {
            const newActivities = appState.familyActivities.filter(activity => activity.id !== id);
            appState.familyActivities = newActivities;
            saveData({ familyActivities: newActivities });
            renderFamilyTimeTab();
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            removeScheduleEvent(day, (appState.schedule[day] || []).find(e => e.time === time && e.activity === activityText && e.type === 'family')?.id);
        }

        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
        function addDailyHabit(habit) {
            const newHabits = [...appState.dailyHabits, { id: Date.now(), ...habit, completed: false }];
            appState.dailyHabits = newHabits;
            saveData({ dailyHabits: newHabits });
            renderDailyHabitsTab();
            addEventToSchedule(habit.day, habit.time, `–ü—Ä–∏–≤—ã—á–∫–∞: ${habit.text}`, 'habit');
        }
        function toggleDailyHabit(id) {
            const newHabits = appState.dailyHabits.map(habit =>
                habit.id === id ? { ...habit, completed: !habit.completed } : habit
            );
            appState.dailyHabits = newHabits;
            saveData({ dailyHabits: newHabits });
            renderDailyHabitsTab();
        }
        function removeDailyHabit(id, day, time, activityText) {
            const newHabits = appState.dailyHabits.filter(habit => habit.id !== id);
            appState.dailyHabits = newHabits;
            saveData({ dailyHabits: newHabits });
            renderDailyHabitsTab();
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            removeScheduleEvent(day, (appState.schedule[day] || []).find(e => e.time === time && e.activity === activityText && e.type === 'habit')?.id);
        }

        // –ü—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±—É—á–µ–Ω–∏–∏
        function addLearningSubject(subject) {
            const newSubjects = [...appState.learningSubjects, { id: Date.now(), ...subject, progress: 0 }];
            appState.learningSubjects = newSubjects;
            saveData({ learningSubjects: newSubjects });
            renderLearningProgressTab();
            addEventToSchedule(subject.day, subject.time, `–û–±—É—á–µ–Ω–∏–µ: ${subject.text}`, 'learning');
        }
        function updateLearningSubjectProgress(id, progress) {
            const newSubjects = appState.learningSubjects.map(subject =>
                subject.id === id ? { ...subject, progress: progress } : subject
            );
            appState.learningSubjects = newSubjects;
            saveData({ learningSubjects: newSubjects });
            renderLearningProgressTab();
        }
        function removeLearningSubject(id, day, time, activityText) {
            const newSubjects = appState.learningSubjects.filter(subject => subject.id !== id);
            appState.learningSubjects = newSubjects;
            saveData({ learningSubjects: newSubjects });
            renderLearningProgressTab();
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            removeScheduleEvent(day, (appState.schedule[day] || []).find(e => e.time === time && e.activity === activityText && e.type === 'learning')?.id);
        }

        // –§–∏–Ω–∞–Ω—Å—ã
        function addTransaction(transaction) {
            const newTransactions = [...appState.transactions, { id: Date.now(), ...transaction, date: new Date().toLocaleDateString() }];
            appState.transactions = newTransactions;
            saveData({ transactions: newTransactions });
            renderFinanceTab();
        }
        function removeTransaction(id) {
            const newTransactions = appState.transactions.filter(t => t.id !== id);
            appState.transactions = newTransactions;
            saveData({ transactions: newTransactions });
            renderFinanceTab();
        }

        // –ó–∞–º–µ—Ç–∫–∏
        function addNote(text) {
            if (text.trim()) {
                const newNotes = [...appState.notes, { id: Date.now(), text, timestamp: Date.now() }];
                appState.notes = newNotes;
                saveData({ notes: newNotes });
                renderNotebookTab();
            }
        }
        function removeNote(id) {
            const newNotes = appState.notes.filter(note => note.id !== id);
            appState.notes = newNotes;
            saveData({ notes: newNotes });
            renderNotebookTab();
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function checkNotifications() {
            const now = new Date();
            const currentDay = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'][now.getDay()];
            const currentHour = now.getHours().toString().padStart(2, '0');
            const currentMinute = now.getMinutes().toString().padStart(2, '0');
            const currentTime = `${currentHour}:${currentMinute}`;

            const eventsToday = appState.schedule[currentDay] || [];

            eventsToday.forEach(event => {
                // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è
                const eventTimeParts = event.time.split(':').map(Number);
                const eventHour = eventTimeParts[0];
                const eventMinute = eventTimeParts[1];

                const eventDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eventHour, eventMinute, 0);
                const diffMinutes = Math.floor((eventDate.getTime() - now.getTime()) / (1000 * 60));

                if (diffMinutes === 10) { // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 10 –º–∏–Ω—É—Ç
                    showMessageModal(`–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ß–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç —É —Ç–µ–±—è "${event.activity}" –≤ ${event.time}!`);
                }
            });
        }

        // --- –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–∫–ª–∞–¥–æ–∫ ---

        function renderScheduleTab() {
            const contentArea = document.getElementById('content-area');
            let selectedDay = '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'; // –î–µ–Ω—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

            const daysOfWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–Ω—è
            const renderDayContent = (day) => {
                const sortedEvents = (appState.schedule[day] || []).sort((a, b) => {
                    const timeA = a.time.split(':').map(Number);
                    const timeB = b.time.split(':').map(Number);
                    if (timeA[0] !== timeB[0]) return timeA[0] - timeB[0];
                    return timeA[1] - timeB[1];
                });

                return `
                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–°–æ–±—ã—Ç–∏—è –Ω–∞ ${day}</h3>
                        ${sortedEvents.length === 0 ? `
                            <p class="text-gray-400 text-center">–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π.</p>
                        ` : `
                            <ul class="space-y-3">
                                ${sortedEvents.map(event => `
                                    <li class="flex items-center justify-between bg-gray-800 p-4 rounded-lg shadow-inner border border-gray-700">
                                        <div>
                                            <span class="text-lg font-semibold text-amber-300">${event.time}</span>
                                            <span class="ml-3 text-gray-200">${event.activity}</span>
                                            ${event.type !== 'default' ? `
                                                <span class="ml-2 px-2 py-1 text-xs font-medium rounded-full bg-gray-600 text-gray-300">
                                                    ${event.type === 'family' ? '–°–µ–º—å—è' : event.type === 'habit' ? '–ü—Ä–∏–≤—ã—á–∫–∞' : '–û–±—É—á–µ–Ω–∏–µ'}
                                                </span>
                                            ` : ''}
                                        </div>
                                        <button data-id="${event.id}" data-day="${day}" class="remove-schedule-event ml-4 text-red-400 hover:text-red-600 transition-colors duration-200">
                                            ${icons.DeleteIcon}
                                        </button>
                                    </li>
                                `).join('')}
                            </ul>
                        `}
                    </div>
                `;
            };

            contentArea.innerHTML = `
                <div class="p-4">
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ú–æ–µ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –≤–∏–¥–µ—Ç—å —Å–≤–æ–π –ø–ª–∞–Ω –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –°–æ–±—ã—Ç–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å.
                    </p>

                    <div class="mb-6 flex flex-wrap justify-center gap-2" id="schedule-day-selector">
                        ${daysOfWeek.map(day => `
                            <button
                                data-day="${day}"
                                class="py-2 px-4 rounded-full font-semibold transition-all duration-200 ease-in-out
                                    ${selectedDay === day ? 'bg-amber-600 text-white shadow-md' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}
                            ">
                                ${day}
                            </button>
                        `).join('')}
                    </div>

                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <input
                                type="time"
                                id="new-event-time"
                                class="w-full sm:w-1/3 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è"
                                id="new-event-description"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <button
                                id="add-event-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center mt-6">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å AI</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <textarea
                                placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –∏—Ö –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—É—á–µ–±–∞ 3 —á–∞—Å–∞, —Å–ø–æ—Ä—Ç 1 —á–∞—Å')"
                                id="schedule-prompt"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500 h-24 resize-y"
                            ></textarea>
                            <button
                                id="generate-schedule-suggestions"
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                ‚ú® –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                            </button>
                        </div>
                    </div>

                    <div id="current-day-schedule-content">
                        ${renderDayContent(selectedDay)}
                    </div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('schedule-day-selector').querySelectorAll('button').forEach(button => {
                button.addEventListener('click', (e) => {
                    selectedDay = e.target.dataset.day;
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
                    document.getElementById('schedule-day-selector').querySelectorAll('button').forEach(btn => {
                        btn.classList.remove('bg-amber-600', 'text-white', 'shadow-md');
                        btn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                    });
                    e.target.classList.add('bg-amber-600', 'text-white', 'shadow-md');
                    e.target.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');

                    document.getElementById('current-day-schedule-content').innerHTML = renderDayContent(selectedDay);
                    addScheduleEventListeners(); // –ü–æ–≤—Ç–æ—Ä–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                });
            });

            const addScheduleEventListeners = () => {
                document.getElementById('add-event-button').onclick = () => {
                    const time = document.getElementById('new-event-time').value;
                    const description = document.getElementById('new-event-description').value;
                    addEventToSchedule(selectedDay, time, description);
                    document.getElementById('new-event-time').value = '';
                    document.getElementById('new-event-description').value = '';
                };
                document.getElementById('new-event-description').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('add-event-button').click();
                    }
                });

                document.querySelectorAll('.remove-schedule-event').forEach(button => {
                    button.onclick = (e) => {
                        const eventId = parseInt(e.currentTarget.dataset.id);
                        const day = e.currentTarget.dataset.day;
                        removeScheduleEvent(day, eventId);
                    };
                });

                document.getElementById('generate-schedule-suggestions').onclick = async () => {
                    const promptText = document.getElementById('schedule-prompt').value;
                    if (!promptText.trim()) {
                        showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.");
                        return;
                    }
                    const generateButton = document.getElementById('generate-schedule-suggestions');
                    generateButton.disabled = true;
                    generateButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
                    showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', '', true);

                    try {
                        const prompt = `–ü—Ä–µ–¥–ª–æ–∂–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å, —É—á–∏—Ç—ã–≤–∞—è —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ –∏—Ö –ø—Ä–∏–º–µ—Ä–Ω—É—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: "${promptText}". –†–∞–∑–±–µ–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.`;
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', result.candidates[0].content.parts[0].text, false);
                        } else {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ—Ç AI:", result);
                            showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏.", false);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                    } finally {
                        generateButton.disabled = false;
                        generateButton.textContent = '‚ú® –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ';
                    }
                };
            };
            addScheduleEventListeners(); // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏
        }

        function renderShoppingTab() {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–°–ø–∏—Å–æ–∫ –ü–æ–∫—É–ø–æ–∫</h2>

                    <div class="flex flex-col items-center justify-center p-6 bg-gray-700 rounded-lg shadow-md border border-gray-600 mb-8">
                        <p class="text-xl text-gray-200 mb-4">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ä–µ–¥–µ–Ω–Ω—ã—Ö –±–∞–Ω–∞–Ω–æ–≤:</p>
                        <div class="flex items-center space-x-4">
                            <button id="decrement-banana" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-5 rounded-full text-2xl transition duration-300 ease-in-out transform hover:scale-105">
                                -
                            </button>
                            <span id="banana-count" class="text-5xl font-bold text-amber-400">${appState.bananaCount}</span>
                            <button id="increment-banana" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-5 rounded-full text-2xl transition duration-300 ease-in-out transform hover:scale-105">
                                +
                            </button>
                        </div>
                        <p class="text-gray-400 mt-4 text-center">
                            –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ä–µ–¥–µ–Ω–Ω—ã—Ö –±–∞–Ω–∞–Ω–æ–≤.
                        </p>
                    </div>

                    <div class="p-6 bg-gray-700 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç (—Å AI –∏–Ω—Ñ–æ)</h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <input
                                type="text"
                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—è–±–ª–æ–∫–æ')"
                                id="product-name"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '2 —à—Ç')"
                                id="product-quantity"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–¶–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                                id="product-price"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <button
                                id="add-product-with-ai"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <div id="loading-product-info" class="text-center text-gray-400 mt-4 hidden">
                            –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ü–µ–Ω—ã... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.
                        </div>
                    </div>

                    <div class="p-6 bg-gray-700 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã —Å AI</h3>
                        <button
                            id="generate-recipe-suggestions"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 w-full disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            ‚ú® –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã
                        </button>
                    </div>

                    ${appState.shoppingList.length === 0 ? `
                        <p class="text-gray-400 text-center">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –ø—É—Å—Ç.</p>
                    ` : `
                        <ul class="space-y-4" id="shopping-list-items">
                            ${appState.shoppingList.map(item => `
                                <li class="flex flex-col sm:flex-row items-center sm:items-start justify-between bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <div class="flex items-center flex-grow mb-4 sm:mb-0">
                                        <input
                                            type="checkbox"
                                            data-id="${item.id}"
                                            ${item.completed ? 'checked' : ''}
                                            class="toggle-shopping-item form-checkbox h-5 w-5 text-amber-600 rounded border-gray-500 bg-gray-800 focus:ring-amber-500 mr-3 cursor-pointer"
                                        />
                                        <img
                                            src="${item.image}"
                                            alt="${item.name}"
                                            class="w-20 h-20 object-contain rounded-lg border border-gray-600 shadow-sm mr-4"
                                            onerror="this.onerror=null;this.src='https://placehold.co/80x80/374151/D1D5DB?text=No+Image';"
                                        />
                                        <div class="flex-grow">
                                            <span class="text-xl font-semibold ${item.completed ? 'line-through text-gray-500' : 'text-amber-300'}">
                                                ${item.name}
                                            </span>
                                            <p class="text-md text-gray-300 ${item.completed ? 'line-through text-gray-400' : ''}">
                                                –ö–æ–ª-–≤–æ: ${item.quantity}
                                                ${item.price ? `<span class="ml-2 text-amber-200">–¶–µ–Ω–∞: ${item.price}</span>` : ''}
                                            </p>
                                            <p class="text-sm text-green-400 mt-1">–ü–æ–ª—å–∑–∞: ${item.benefits}</p>
                                            <p class="text-sm text-red-400">–í—Ä–µ–¥: ${item.harms}</p>
                                        </div>
                                    </div>
                                    <button data-id="${item.id}" class="remove-shopping-item ml-0 sm:ml-4 text-red-400 hover:text-red-600 transition-colors duration-200">
                                        ${icons.DeleteIcon}
                                    </button>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('increment-banana').onclick = incrementBanana;
            document.getElementById('decrement-banana').onclick = decrementBanana;

            document.getElementById('add-product-with-ai').onclick = async () => {
                const productName = document.getElementById('product-name').value;
                const quantity = document.getElementById('product-quantity').value;
                const price = document.getElementById('product-price').value;
                const addButton = document.getElementById('add-product-with-ai');
                const loadingDiv = document.getElementById('loading-product-info');

                if (!productName.trim()) {
                    showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞.");
                    return;
                }

                addButton.disabled = true;
                loadingDiv.classList.remove('hidden');

                let generatedImage = null;
                let generatedText = null;
                let suggestedPrice = price;

                try {
                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    addButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...';
                    const imagePrompt = `A high-quality, realistic photo of ${productName} on a clean white background. Studio lighting, isolated object.`;
                    const imagePayload = { instances: { prompt: imagePrompt }, parameters: { "sampleCount": 1 } };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const imageUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                    const imageResponse = await fetch(imageUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(imagePayload)
                    });
                    const imageResult = await imageResponse.json();
                    if (imageResult.predictions && imageResult.predictions.length > 0 && imageResult.predictions[0].bytesBase64Encoded) {
                        generatedImage = `data:image/png;base64,${imageResult.predictions[0].bytesBase64Encoded}`;
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:", imageResult);
                        showMessageModal("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞.");
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:", error);
                    showMessageModal("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                }

                try {
                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (–ø–æ–ª—å–∑–∞ –∏ –≤—Ä–µ–¥)
                    addButton.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ...';
                    const textPrompt = `–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–µ –∏ –≤—Ä–µ–¥–µ –ø—Ä–æ–¥—É–∫—Ç–∞ "${productName}". –§–æ—Ä–º–∞—Ç: "–ü–æ–ª—å–∑–∞: [—Å–ø–∏—Å–æ–∫]. –í—Ä–µ–¥: [—Å–ø–∏—Å–æ–∫]."`;
                    const chatHistory = [{ role: "user", parts: [{ text: textPrompt }] }];
                    const textPayload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const textUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const textResponse = await fetch(textUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(textPayload)
                    });
                    const textResult = await textResponse.json();
                    if (textResult.candidates && textResult.candidates.length > 0 &&
                        textResult.candidates[0].content && textResult.candidates[0].content.parts &&
                        textResult.candidates[0].content.parts.length > 0) {
                        generatedText = textResult.candidates[0].content.parts[0].text;
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞:", textResult);
                        showMessageModal("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–µ.");
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ç–µ–∫—Å—Ç–∞:", error);
                    showMessageModal("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
                }

                if (!suggestedPrice) {
                    addButton.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã...';
                    try {
                        const pricePrompt = `–ö–∞–∫–æ–≤–∞ –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞ "${productName}" –≤ —Ç–µ–Ω–≥–µ? –£–∫–∞–∂–∏ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.`;
                        const chatHistoryPrice = [{ role: "user", parts: [{ text: pricePrompt }] }];
                        const pricePayload = { contents: chatHistoryPrice };
                        const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        const priceUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const priceResponse = await fetch(priceUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(pricePayload)
                        });
                        const priceResult = await priceResponse.json();
                        if (priceResult.candidates && priceResult.candidates.length > 0 &&
                            priceResult.candidates[0].content && priceResult.candidates[0].content.parts &&
                            priceResult.candidates[0].content.parts.length > 0) {
                            const rawPrice = priceResult.candidates[0].content.parts[0].text;
                            const numericPrice = parseFloat(rawPrice.replace(/[^0-9.,]/g, '').replace(',', '.'));
                            if (!isNaN(numericPrice)) {
                                suggestedPrice = `${numericPrice.toFixed(2)} KZT (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è AI)`;
                            } else {
                                suggestedPrice = "–¶–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (AI)";
                            }
                        } else {
                            suggestedPrice = "–¶–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (AI)";
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ü–µ–Ω—ã AI:", error);
                        suggestedPrice = "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã (AI)";
                    }
                }

                if (generatedImage || generatedText || suggestedPrice) {
                    let benefits = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
                    let harms = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.";
                    if (generatedText) {
                        const benefitMatch = generatedText.match(/–ü–æ–ª—å–∑–∞:\s*([^.]+)\./i);
                        const harmMatch = generatedText.match(/–í—Ä–µ–¥:\s*([^.]+)\./i);
                        if (benefitMatch && benefitMatch[1]) {
                            benefits = benefitMatch[1].trim();
                        }
                        if (harmMatch && harmMatch[1]) {
                            harms = harmMatch[1].trim();
                        }
                    }
                    addShoppingItem({
                        name: productName,
                        quantity: quantity || '1 —à—Ç.',
                        price: suggestedPrice || '–ù–µ —É–∫–∞–∑–∞–Ω–∞',
                        image: generatedImage || 'https://placehold.co/150x150/374151/D1D5DB?text=No+Image',
                        benefits: benefits,
                        harms: harms,
                    });
                    document.getElementById('product-name').value = '';
                    document.getElementById('product-quantity').value = '';
                    document.getElementById('product-price').value = '';
                }
                addButton.disabled = false;
                addButton.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
                loadingDiv.classList.add('hidden');
            };

            document.getElementById('generate-recipe-suggestions').onclick = async () => {
                const generateButton = document.getElementById('generate-recipe-suggestions');
                if (appState.shoppingList.length === 0) {
                    showMessageModal("–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã.");
                    return;
                }

                generateButton.disabled = true;
                generateButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤...';
                showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã', '', true);

                const ingredients = appState.shoppingList.map(item => item.name).join(', ');
                try {
                    const prompt = `–ü—Ä–µ–¥–ª–æ–∂–∏ 3-5 –ø—Ä–æ—Å—Ç—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã: ${ingredients}. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ —É–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è.`;
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã', result.candidates[0].content.parts[0].text, false);
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –æ—Ç AI:", result);
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã', "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫.", false);
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                    showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã', "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                } finally {
                    generateButton.disabled = false;
                    generateButton.textContent = '‚ú® –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã';
                }
            };

            document.querySelectorAll('.toggle-shopping-item').forEach(checkbox => {
                checkbox.onchange = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    toggleShoppingItem(id);
                };
            });

            document.querySelectorAll('.remove-shopping-item').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    removeShoppingItem(id);
                };
            });
        }

        function renderGoalsTab() {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ú–æ–∏ –¶–µ–ª–∏</h2>
                    <div class="flex mb-4">
                        <input
                            type="text"
                            placeholder="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å..."
                            id="new-goal-text"
                            class="flex-grow p-3 rounded-l-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                        />
                        <button
                            id="add-goal-button"
                            class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-r-lg transition duration-300 ease-in-out transform hover:scale-105"
                        >
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                    ${appState.goals.length === 0 ? `
                        <p class="text-gray-400 text-center">–°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π –ø—É—Å—Ç.</p>
                    ` : `
                        <ul class="space-y-3" id="goals-list-items">
                            ${appState.goals.map(goal => `
                                <li class="flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <span
                                        data-id="${goal.id}"
                                        class="toggle-goal flex-grow text-lg cursor-pointer ${goal.completed ? 'line-through text-gray-500' : 'text-gray-200'}"
                                    >
                                        ${goal.text}
                                    </span>
                                    <div class="flex items-center mt-2 sm:mt-0 space-x-2">
                                        <button
                                            data-goal-text="${goal.text}"
                                            class="generate-action-plan bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out transform hover:scale-105 flex items-center"
                                        >
                                            ‚ú® –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω
                                        </button>
                                        <button
                                            data-id="${goal.id}"
                                            class="remove-goal text-red-400 hover:text-red-600 transition-colors duration-200"
                                        >
                                            ${icons.DeleteIcon}
                                        </button>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-goal-button').onclick = () => {
                const newGoalText = document.getElementById('new-goal-text').value;
                addGoal(newGoalText);
                document.getElementById('new-goal-text').value = '';
            };
            document.getElementById('new-goal-text').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('add-goal-button').click();
                }
            });

            document.querySelectorAll('.toggle-goal').forEach(span => {
                span.onclick = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    toggleGoal(id);
                };
            });

            document.querySelectorAll('.remove-goal').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    removeGoal(id);
                };
            });

            document.querySelectorAll('.generate-action-plan').forEach(button => {
                button.onclick = async (e) => {
                    const goalText = e.currentTarget.dataset.goalText;
                    e.currentTarget.disabled = true;
                    e.currentTarget.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
                    showAIModal(`–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ü–µ–ª–∏: "${goalText}"`, '', true);

                    try {
                        const prompt = `–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ª–∏: "${goalText}". –†–∞–∑–±–µ–π –µ–≥–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ä–æ–∫–æ–≤ –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.`;
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            showAIModal(`–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ü–µ–ª–∏: "${goalText}"`, result.candidates[0].content.parts[0].text, false);
                        } else {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞ –æ—Ç AI:", result);
                            showAIModal(`–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ü–µ–ª–∏: "${goalText}"`, "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª—å.", false);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                        showAIModal(`–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ü–µ–ª–∏: "${goalText}"`, "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                    } finally {
                        e.currentTarget.disabled = false;
                        e.currentTarget.textContent = '‚ú® –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω';
                    }
                };
            });
        }

        function renderFamilyTimeTab() {
            const contentArea = document.getElementById('content-area');
            const daysOfWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];

            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–í—Ä–µ–º—è —Å –°–µ–º—å–µ–π</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –ü–ª–∞–Ω–∏—Ä—É–π —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —á—Ç–æ–±—ã –ø—Ä–æ–≤–æ–¥–∏—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ —Å –±–ª–∏–∑–∫–∏–º–∏. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ —Ç–≤–æ–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.
                    </p>
                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–î–æ–±–∞–≤–∏—Ç—å —Å–µ–º–µ–π–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <select
                                id="family-activity-day"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            >
                                ${daysOfWeek.map(day => `<option value="${day}">${day}</option>`).join('')}
                            </select>
                            <input
                                type="time"
                                id="family-activity-time"
                                value="19:00"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–ö–∏–Ω–æ–≤–µ—á–µ—Ä')"
                                id="new-family-activity-text"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <button
                                id="add-family-activity-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center mt-6">–ò–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏ —Å AI</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <textarea
                                placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ –∏–¥–µ–∏ –≤—ã –∏—â–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ –¥–ª—è –¥–µ—Ç–µ–π 5-7 –ª–µ—Ç')"
                                id="family-activity-prompt"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500 h-24 resize-y"
                            ></textarea>
                            <button
                                id="generate-family-activity-suggestions"
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                ‚ú® –ò–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏
                            </button>
                        </div>
                    </div>
                    ${appState.familyActivities.length === 0 ? `
                        <p class="text-gray-400 text-center">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–º–µ–π–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</p>
                    ` : `
                        <ul class="space-y-3" id="family-activities-list">
                            ${appState.familyActivities.map(activity => `
                                <li class="flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <span class="flex-grow text-lg text-gray-200">${activity.text} (${activity.day}, ${activity.time})</span>
                                    <button
                                        data-id="${activity.id}"
                                        data-day="${activity.day}"
                                        data-time="${activity.time}"
                                        data-activity-text="–°–µ–º—å—è: ${activity.text}"
                                        class="remove-family-activity ml-4 text-red-400 hover:text-red-600 transition-colors duration-200"
                                    >
                                        ${icons.DeleteIcon}
                                    </button>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-family-activity-button').onclick = () => {
                const newActivityText = document.getElementById('new-family-activity-text').value;
                const day = document.getElementById('family-activity-day').value;
                const time = document.getElementById('family-activity-time').value;
                addFamilyActivity({ text: newActivityText, day: day, time: time });
                document.getElementById('new-family-activity-text').value = '';
            };
            document.getElementById('new-family-activity-text').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('add-family-activity-button').click();
                }
            });

            document.querySelectorAll('.remove-family-activity').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    const day = e.currentTarget.dataset.day;
                    const time = e.currentTarget.dataset.time;
                    const activityText = e.currentTarget.dataset.activityText;
                    removeFamilyActivity(id, day, time, activityText);
                };
            });

            document.getElementById('generate-family-activity-suggestions').onclick = async () => {
                const promptText = document.getElementById('family-activity-prompt').value;
                if (!promptText.trim()) {
                    showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ –∏–¥–µ–∏ –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–æ—Å—É–≥–∞ –≤—ã –∏—â–µ—Ç–µ.");
                    return;
                }
                const generateButton = document.getElementById('generate-family-activity-suggestions');
                generateButton.disabled = true;
                generateButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
                showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏', '', true);

                try {
                    const prompt = `–ü—Ä–µ–¥–ª–æ–∂–∏ 3-5 –∏–¥–µ–π –¥–ª—è —Å–µ–º–µ–π–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —É—á–∏—Ç—ã–≤–∞—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: "${promptText}".`;
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏', result.candidates[0].content.parts[0].text, false);
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–¥–µ–π –æ—Ç AI:", result);
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏', "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è.", false);
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                    showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏', "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                } finally {
                    generateButton.disabled = false;
                    generateButton.textContent = '‚ú® –ò–¥–µ–∏ –¥–ª—è —Å–µ–º—å–∏';
                }
            };
        }

        function renderDailyHabitsTab() {
            const contentArea = document.getElementById('content-area');
            const daysOfWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];

            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ü—Ä–∏–≤—ã—á–∫–∏</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –û—Ç–º–µ—á–∞–π —Å–≤–æ–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ —Ç–≤–æ–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.
                    </p>
                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <select
                                id="habit-day"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            >
                                ${daysOfWeek.map(day => `<option value="${day}">${day}</option>`).join('')}
                            </select>
                            <input
                                type="time"
                                id="habit-time"
                                value="08:00"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–ú–µ–¥–∏—Ç–∞—Ü–∏—è 5 –º–∏–Ω')"
                                id="new-habit-text"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <button
                                id="add-habit-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center mt-6">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏ —Å AI</h3>
                        <div class="flex flex-col sm:flex-row gap-4">
                            <textarea
                                placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —Ä–∞–∑–≤–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏')"
                                id="habit-prompt"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500 h-24 resize-y"
                            ></textarea>
                            <button
                                id="generate-habit-suggestions"
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                ‚ú® –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏
                            </button>
                        </div>
                    </div>
                    ${appState.dailyHabits.length === 0 ? `
                        <p class="text-gray-400 text-center">–ü–æ–∫–∞ –Ω–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫.</p>
                    ` : `
                        <ul class="space-y-3" id="daily-habits-list">
                            ${appState.dailyHabits.map(habit => `
                                <li class="flex items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <span
                                        data-id="${habit.id}"
                                        class="toggle-daily-habit flex-grow text-lg cursor-pointer ${habit.completed ? 'line-through text-gray-500' : 'text-gray-200'}"
                                    >
                                        ${habit.text} (${habit.day}, ${habit.time})
                                    </span>
                                    <button
                                        data-id="${habit.id}"
                                        data-day="${habit.day}"
                                        data-time="${habit.time}"
                                        data-activity-text="–ü—Ä–∏–≤—ã—á–∫–∞: ${habit.text}"
                                        class="remove-daily-habit ml-4 text-red-400 hover:text-red-600 transition-colors duration-200"
                                    >
                                        ${icons.DeleteIcon}
                                    </button>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-habit-button').onclick = () => {
                const newHabitText = document.getElementById('new-habit-text').value;
                const day = document.getElementById('habit-day').value;
                const time = document.getElementById('habit-time').value;
                addDailyHabit({ text: newHabitText, day: day, time: time });
                document.getElementById('new-habit-text').value = '';
            };
            document.getElementById('new-habit-text').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('add-habit-button').click();
                }
            });

            document.querySelectorAll('.toggle-daily-habit').forEach(span => {
                span.onclick = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    toggleDailyHabit(id);
                };
            });

            document.querySelectorAll('.remove-daily-habit').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    const day = e.currentTarget.dataset.day;
                    const time = e.currentTarget.dataset.time;
                    const activityText = e.currentTarget.dataset.activityText;
                    removeDailyHabit(id, day, time, activityText);
                };
            });

            document.getElementById('generate-habit-suggestions').onclick = async () => {
                const promptText = document.getElementById('habit-prompt').value;
                if (!promptText.trim()) {
                    showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —Ä–∞–∑–≤–∏—Ç—å.");
                    return;
                }
                const generateButton = document.getElementById('generate-habit-suggestions');
                generateButton.disabled = true;
                generateButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
                showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏', '', true);

                try {
                    const prompt = `–ü—Ä–µ–¥–ª–æ–∂–∏ 3-5 –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–∑–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫, —É—á–∏—Ç—ã–≤–∞—è —Å–ª–µ–¥—É—é—â—É—é —Ü–µ–ª—å –∏–ª–∏ –æ–±–ª–∞—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è: "${promptText}". –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ —É–∫–∞–∂–∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω—É—é –ø–æ–ª—å–∑—É.`;
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏', result.candidates[0].content.parts[0].text, false);
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–∏–≤—ã—á–µ–∫ –æ—Ç AI:", result);
                        showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏', "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.", false);
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                    showAIModal('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏', "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                } finally {
                    generateButton.disabled = false;
                    generateButton.textContent = '‚ú® –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏';
                }
            };
        }

        function renderLearningProgressTab() {
            const contentArea = document.getElementById('content-area');
            const daysOfWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];

            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ –û–±—É—á–µ–Ω–∏–∏</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –û—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —à–∫–æ–ª–µ/—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—É. –û–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ —Ç–≤–æ–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.
                    </p>
                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <select
                                id="learning-subject-day"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            >
                                ${daysOfWeek.map(day => `<option value="${day}">${day}</option>`).join('')}
                            </select>
                            <input
                                type="time"
                                id="learning-subject-time"
                                value="10:00"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="text"
                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ 9 –∫–ª–∞—Å—Å')"
                                id="new-learning-subject-text"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <button
                                id="add-learning-subject-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    ${appState.learningSubjects.length === 0 ? `
                        <p class="text-gray-400 text-center">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.</p>
                    ` : `
                        <ul class="space-y-3" id="learning-subjects-list">
                            ${appState.learningSubjects.map(subject => `
                                <li class="flex flex-col sm:flex-row items-start sm:items-center justify-between bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <div class="flex-grow">
                                        <span class="text-lg text-gray-200">${subject.text} (${subject.day}, ${subject.time})</span>
                                        <div class="flex items-center mt-2 sm:mt-0">
                                            <input
                                                type="range"
                                                min="0"
                                                max="100"
                                                value="${subject.progress}"
                                                data-id="${subject.id}"
                                                class="update-learning-progress w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-amber-500"
                                            />
                                            <span class="ml-3 text-gray-300">${subject.progress}%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center mt-2 sm:mt-0 space-x-2">
                                        <button
                                            data-subject-text="${subject.text}"
                                            class="generate-quiz-questions bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out transform hover:scale-105 flex items-center"
                                        >
                                            ‚ú® –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
                                        </button>
                                        <button
                                            data-id="${subject.id}"
                                            data-day="${subject.day}"
                                            data-time="${subject.time}"
                                            data-activity-text="–û–±—É—á–µ–Ω–∏–µ: ${subject.text}"
                                            class="remove-learning-subject ml-0 sm:ml-4 mt-2 sm:mt-0 text-red-400 hover:text-red-600 transition-colors duration-200"
                                        >
                                            ${icons.DeleteIcon}
                                        </button>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-learning-subject-button').onclick = () => {
                const newSubjectText = document.getElementById('new-learning-subject-text').value;
                const day = document.getElementById('learning-subject-day').value;
                const time = document.getElementById('learning-subject-time').value;
                addLearningSubject({ text: newSubjectText, day: day, time: time });
                document.getElementById('new-learning-subject-text').value = '';
            };
            document.getElementById('new-learning-subject-text').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('add-learning-subject-button').click();
                }
            });

            document.querySelectorAll('.update-learning-progress').forEach(input => {
                input.onchange = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    const progress = parseInt(e.target.value);
                    updateLearningSubjectProgress(id, progress);
                };
            });

            document.querySelectorAll('.remove-learning-subject').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    const day = e.currentTarget.dataset.day;
                    const time = e.currentTarget.dataset.time;
                    const activityText = e.currentTarget.dataset.activityText;
                    removeLearningSubject(id, day, time, activityText);
                };
            });

            document.querySelectorAll('.generate-quiz-questions').forEach(button => {
                button.onclick = async (e) => {
                    const subjectText = e.currentTarget.dataset.subjectText;
                    e.currentTarget.disabled = true;
                    e.currentTarget.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
                    showAIModal(`–í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ —Ç–µ–º–µ: "${subjectText}"`, '', true);

                    try {
                        const prompt = `–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ —Ç–µ–º–µ: "${subjectText}". –ö–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ (A, B, C, D) –∏ —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: A").`;
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            showAIModal(`–í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ —Ç–µ–º–µ: "${subjectText}"`, result.candidates[0].content.parts[0].text, false);
                        } else {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –æ—Ç AI:", result);
                            showAIModal(`–í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ —Ç–µ–º–µ: "${subjectText}"`, "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—É.", false);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                        showAIModal(`–í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ —Ç–µ–º–µ: "${subjectText}"`, "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                    } finally {
                        e.currentTarget.disabled = false;
                        e.currentTarget.textContent = '‚ú® –í–∏–∫—Ç–æ—Ä–∏–Ω–∞';
                    }
                }
            });
        }

        function renderFinanceTab() {
            const contentArea = document.getElementById('content-area');
            const totalBalance = appState.transactions.reduce((sum, t) => sum + t.amount, 0);

            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ú–æ–∏ –§–∏–Ω–∞–Ω—Å—ã</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –û—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–≤–æ–∏ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã.
                    </p>
                    <div class="p-6 bg-gray-700 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–¢–µ–∫—É—â–∏–π –ë–∞–ª–∞–Ω—Å: <span class="${totalBalance >= 0 ? 'text-green-400' : 'text-red-400'}">${totalBalance.toFixed(2)}</span></h3>
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <input
                                type="text"
                                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–ó–∞—Ä–∞–±–æ—Ç–æ–∫', '–ü–æ–∫—É–ø–∫–∞')"
                                id="transaction-description"
                                class="flex-grow p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <input
                                type="number"
                                placeholder="–°—É–º–º–∞"
                                id="transaction-amount"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            />
                            <select
                                id="transaction-type"
                                class="w-full sm:w-1/4 p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                            >
                                <option value="income">–î–æ—Ö–æ–¥</option>
                                <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                            </select>
                            <button
                                id="add-transaction-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center mt-6">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç —Å AI</h3>
                        <button
                            id="generate-finance-tips"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 w-full disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            ‚ú® –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç
                        </button>
                    </div>
                    ${appState.transactions.length === 0 ? `
                        <p class="text-gray-400 text-center">–ü–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</p>
                    ` : `
                        <ul class="space-y-3 mt-4" id="transactions-list">
                            ${appState.transactions.map(t => `
                                <li class="flex items-center justify-between bg-gray-800 p-4 rounded-lg shadow-md border border-gray-700">
                                    <div>
                                        <span class="text-lg text-gray-200">${t.description}</span>
                                        <span class="block text-sm text-gray-400">${t.date}</span>
                                    </div>
                                    <div class="font-bold text-lg ${t.amount >= 0 ? 'text-green-400' : 'text-red-400'}">
                                        ${t.amount.toFixed(2)}
                                    </div>
                                    <button
                                        data-id="${t.id}"
                                        class="remove-transaction ml-4 text-red-400 hover:text-red-600 transition-colors duration-200"
                                    >
                                        ${icons.DeleteIcon}
                                    </button>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-transaction-button').onclick = () => {
                const description = document.getElementById('transaction-description').value;
                const amount = parseFloat(document.getElementById('transaction-amount').value);
                const type = document.getElementById('transaction-type').value;

                if (!description.trim() || isNaN(amount)) {
                    showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É.");
                    return;
                }
                addTransaction({ description, amount: type === 'expense' ? -amount : amount, type });
                document.getElementById('transaction-description').value = '';
                document.getElementById('transaction-amount').value = '';
            };

            document.querySelectorAll('.remove-transaction').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    removeTransaction(id);
                };
            });

            document.getElementById('generate-finance-tips').onclick = async () => {
                const generateButton = document.getElementById('generate-finance-tips');
                if (appState.transactions.length === 0) {
                    showMessageModal("–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã.");
                    return;
                }

                generateButton.disabled = true;
                generateButton.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–≤–µ—Ç–æ–≤...';
                showAIModal('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã', '', true);

                const transactionSummary = appState.transactions.map(t => `${t.type === 'expense' ? '–†–∞—Å—Ö–æ–¥' : '–î–æ—Ö–æ–¥'}: ${t.description} - ${t.amount} KZT`).join('\n');
                try {
                    const prompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n${transactionSummary}`;
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        showAIModal('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã', result.candidates[0].content.parts[0].text, false);
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ –æ—Ç AI:", result);
                        showAIModal('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã', "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.", false);
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                    showAIModal('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã', "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                } finally {
                    generateButton.disabled = false;
                    generateButton.textContent = '‚ú® –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç';
                }
            };
        }

        function renderSchulteTableTab() {
            const contentArea = document.getElementById('content-area');
            let size = 5;
            let cells = [];
            let currentNumber = 1;
            let startTime = null;
            let elapsedTime = 0;
            let gameOver = false;
            let timerInterval = null;

            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            };

            const generateTable = () => {
                const numbers = Array.from({ length: size * size }, (_, i) => i + 1);
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –§–∏—à–µ—Ä–∞-–ô–µ—Ç—Å–∞
                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }
                cells = numbers;
                currentNumber = 1;
                startTime = null;
                elapsedTime = 0;
                gameOver = false;
                clearInterval(timerInterval);
                renderSchulteContent();
            };

            const handleCellClick = (number) => {
                if (gameOver) return;

                if (number === currentNumber) {
                    if (currentNumber === 1) {
                        startTime = Date.now();
                        timerInterval = setInterval(() => {
                            elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                            document.getElementById('schulte-time').textContent = formatTime(elapsedTime);
                        }, 1000);
                    }
                    if (currentNumber === size * size) {
                        gameOver = true;
                        clearInterval(timerInterval);
                    }
                    currentNumber++;
                    // –û—Ç–º–µ—á–∞–µ–º —è—á–µ–π–∫—É –∫–∞–∫ –Ω–∞–π–¥–µ–Ω–Ω—É—é
                    cells = cells.map(cell =>
                        cell === number ? 'found' : cell
                    );
                    renderSchulteContent();
                }
            };

            const renderSchulteContent = () => {
                contentArea.innerHTML = `
                    <div class="flex flex-col items-center p-4">
                        <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–¢–∞–±–ª–∏—Ü–∞ –®—É–ª—å—Ç–µ</h2>
                        <p class="text-gray-300 mb-4 text-center">
                            –ù–∞–π–¥–∏ —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É –æ—Ç 1 –¥–æ ${size * size} –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ.
                        </p>

                        <div class="flex items-center space-x-4 mb-6">
                            <label htmlFor="table-size" class="text-gray-300">–†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã:</label>
                            <select
                                id="table-size"
                                value="${size}"
                                class="p-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-amber-500"
                                ${startTime && !gameOver ? 'disabled' : ''}
                            >
                                <option value="3">3x3</option>
                                <option value="4">4x4</option>
                                <option value="5">5x5</option>
                                <option value="6">6x6</option>
                                <option value="7">7x7</option>
                            </select>
                            <button
                                id="schulte-reset-button"
                                class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out transform hover:scale-105"
                            >
                                –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
                            </button>
                        </div>

                        <div class="text-xl font-semibold text-amber-300 mb-4">
                            –°–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ: <span class="text-white" id="schulte-current-number">${currentNumber > size * size ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ!' : currentNumber}</span>
                        </div>
                        <div class="text-xl font-semibold text-gray-300 mb-6">
                            –í—Ä–µ–º—è: <span class="text-white" id="schulte-time">${formatTime(elapsedTime)}</span>
                        </div>

                        ${gameOver ? `
                            <div class="text-green-400 text-2xl font-bold mb-4">
                                –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Ä–µ–º—è: ${formatTime(elapsedTime)}
                            </div>
                        ` : ''}

                        <div
                            id="schulte-grid"
                            class="schulte-grid"
                            style="grid-template-columns: repeat(${size}, minmax(0, 1fr)); width: ${size * 60}px; max-width: 90vw; aspect-ratio: 1 / 1;"
                        >
                            ${cells.map((cell, index) => `
                                <div
                                    data-number="${typeof cell === 'number' ? cell : ''}"
                                    class="schulte-cell ${cell === 'found' ? 'found' : ''}"
                                >
                                    <span>${cell === 'found' ? '‚úì' : cell}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                document.getElementById('table-size').onchange = (e) => {
                    size = parseInt(e.target.value);
                    generateTable();
                };
                document.getElementById('schulte-reset-button').onclick = generateTable;

                document.querySelectorAll('.schulte-cell').forEach(cellElement => {
                    cellElement.onclick = (e) => {
                        const number = parseInt(e.currentTarget.dataset.number);
                        handleCellClick(number);
                    };
                });
            };

            generateTable(); // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
        }

        function renderNotebookTab() {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">–ú–æ–π –ë–ª–æ–∫–Ω–æ—Ç</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –ó–∞–ø–∏—Å—ã–≤–∞–π —Å–≤–æ–∏ –º—ã—Å–ª–∏, –∏–¥–µ–∏ –∏ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
                    </p>
                    <div class="bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 mb-8">
                        <h3 class="text-2xl font-bold text-amber-300 mb-4 text-center">–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>
                        <textarea
                            id="new-note-text"
                            class="w-full p-3 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:border-amber-500 h-32 resize-y mb-4"
                            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –∑–∞–º–µ—Ç–∫—É –∑–¥–µ—Å—å..."
                        ></textarea>
                        <button
                            id="add-note-button"
                            class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 w-full"
                        >
                            –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
                        </button>
                    </div>
                    ${appState.notes.length === 0 ? `
                        <p class="text-gray-400 text-center">–í –±–ª–æ–∫–Ω–æ—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ç–æ–∫.</p>
                    ` : `
                        <ul class="space-y-4" id="notes-list">
                            ${appState.notes.map(note => `
                                <li class="flex flex-col bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600">
                                    <p class="text-gray-200 text-lg mb-2 whitespace-pre-wrap">${note.text}</p>
                                    <span class="text-gray-400 text-sm mb-3">–°–æ–∑–¥–∞–Ω–æ: ${new Date(note.timestamp).toLocaleString()}</span>
                                    <div class="flex justify-end space-x-2 mt-2">
                                        <button
                                            data-note-text="${note.text}"
                                            data-type="summarize"
                                            class="process-note-with-ai bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out transform hover:scale-105 flex items-center"
                                        >
                                            ‚ú® –°–≤–æ–¥–∫–∞
                                        </button>
                                        <button
                                            data-note-text="${note.text}"
                                            data-type="expand"
                                            class="process-note-with-ai bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out transform hover:scale-105 flex items-center"
                                        >
                                            ‚ú® –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å
                                        </button>
                                        <button
                                            data-id="${note.id}"
                                            class="remove-note text-red-400 hover:text-red-600 transition-colors duration-200"
                                        >
                                            ${icons.DeleteIcon}
                                        </button>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    `}
                </div>
            `;

            document.getElementById('add-note-button').onclick = () => {
                const newNoteText = document.getElementById('new-note-text').value;
                addNote(newNoteText);
                document.getElementById('new-note-text').value = '';
            };

            document.querySelectorAll('.remove-note').forEach(button => {
                button.onclick = (e) => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    removeNote(id);
                };
            });

            document.querySelectorAll('.process-note-with-ai').forEach(button => {
                button.onclick = async (e) => {
                    const noteText = e.currentTarget.dataset.noteText;
                    const type = e.currentTarget.dataset.type;
                    e.currentTarget.disabled = true;
                    e.currentTarget.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';

                    let title = type === 'summarize' ? '–°–≤–æ–¥–∫–∞ –∑–∞–º–µ—Ç–∫–∏' : '–†–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è –∑–∞–º–µ—Ç–∫–∞';
                    showAIModal(title, '', true);

                    let prompt;
                    if (type === 'summarize') {
                        prompt = `–°–¥–µ–ª–∞–π –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–º–µ—Ç–∫–∏: "${noteText}"`;
                    } else if (type === 'expand') {
                        prompt = `–†–∞–∑–≤–µ—Ä–Ω–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏ —Å–ª–µ–¥—É—é—â—É—é –∑–∞–º–µ—Ç–∫—É, –¥–æ–±–∞–≤–∏–≤ –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –∏ –∏–¥–µ–π: "${noteText}"`;
                    } else {
                        showAIModal(title, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ AI.", false);
                        e.currentTarget.disabled = false;
                        e.currentTarget.textContent = type === 'summarize' ? '‚ú® –°–≤–æ–¥–∫–∞' : '‚ú® –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
                        return;
                    }

                    try {
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            showAIModal(title, result.candidates[0].content.parts[0].text, false);
                        } else {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI:", result);
                            showAIModal(title, "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å.", false);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                        showAIModal(title, "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.", false);
                    } finally {
                        e.currentTarget.disabled = false;
                        e.currentTarget.textContent = type === 'summarize' ? '‚ú® –°–≤–æ–¥–∫–∞' : '‚ú® –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
                    }
                };
            });
        }

        function renderAIAssistantTab() {
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = `
                <div>
                    <h2 class="text-3xl font-bold text-amber-400 mb-6 text-center">AI –ü–æ–º–æ—â–Ω–∏–∫</h2>
                    <p class="text-gray-300 mb-6 text-center">
                        –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–ª—É—á–∞–π —Å–æ–≤–µ—Ç—ã –æ—Ç —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞.
                    </p>
                    <div class="flex flex-col gap-4">
                        <textarea
                            id="ai-prompt-text"
                            class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-amber-500 h-32 resize-y"
                            placeholder="–ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å AI (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–ö–∞–∫ –º–Ω–µ –ª—É—á—à–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ–Ω—å –¥–ª—è —É—á–µ–±—ã?')"
                        ></textarea>
                        <button
                            id="send-message-to-ai"
                            class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            –°–ø—Ä–æ—Å–∏—Ç—å AI
                        </button>

                        <div id="ai-loading-indicator" class="text-center text-gray-400 mt-4 hidden">
                            AI –¥—É–º–∞–µ—Ç...
                        </div>

                        <div id="ai-response-display" class="mt-6 p-4 bg-gray-800 rounded-lg shadow-inner border border-amber-600 hidden">
                            <h3 class="text-xl font-semibold text-amber-300 mb-2">–û—Ç–≤–µ—Ç AI:</h3>
                            <p id="ai-response-text" class="text-gray-200 whitespace-pre-wrap"></p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('send-message-to-ai').onclick = async () => {
                const promptText = document.getElementById('ai-prompt-text').value;
                const sendButton = document.getElementById('send-message-to-ai');
                const loadingIndicator = document.getElementById('ai-loading-indicator');
                const responseDisplay = document.getElementById('ai-response-display');
                const responseText = document.getElementById('ai-response-text');

                if (!promptText.trim()) {
                    showMessageModal("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å.");
                    return;
                }

                sendButton.disabled = true;
                loadingIndicator.classList.remove('hidden');
                responseDisplay.classList.add('hidden');
                responseText.textContent = '';

                try {
                    const chatHistory = [{ role: "user", parts: [{ text: promptText }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // –≠—Ç–æ—Ç –∫–ª—é—á –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω Canvas –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        responseText.textContent = result.candidates[0].content.parts[0].text;
                        responseDisplay.classList.remove('hidden');
                    } else {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI:", result);
                        showMessageModal("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞—Ç—å.");
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ AI:", error);
                    showMessageModal("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.");
                } finally {
                    sendButton.disabled = false;
                    loadingIndicator.classList.add('hidden');
                }
            };
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function renderApp() {
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏

            switch (activeTab) {
                case 'schedule':
                    renderScheduleTab();
                    break;
                case 'shopping':
                    renderShoppingTab();
                    break;
                case 'goals':
                    renderGoalsTab();
                    break;
                case 'family-time':
                    renderFamilyTimeTab();
                    break;
                case 'daily-habits':
                    renderDailyHabitsTab();
                    break;
                case 'learning-progress':
                    renderLearningProgressTab();
                    break;
                case 'finance':
                    renderFinanceTab();
                    break;
                case 'schulte-table':
                    renderSchulteTableTab();
                    break;
                case 'notebook':
                    renderNotebookTab();
                    break;
                case 'ai-assistant':
                    renderAIAssistantTab();
                    break;
                default:
                    renderScheduleTab(); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    break;
            }
            updateTabButtons(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –≤–∫–ª–∞–¥–æ–∫
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤–∫–ª–∞–¥–æ–∫ –∏ –∏—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π
        function setupTabs() {
            const navTabs = document.getElementById('nav-tabs');
            const tabs = [
                { id: 'schedule', text: '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ', icon: icons.ScheduleIcon },
                { id: 'shopping', text: '–ü–æ–∫—É–ø–∫–∏', icon: icons.ShoppingCartIcon },
                { id: 'goals', text: '–¶–µ–ª–∏', icon: icons.TargetIcon },
                { id: 'family-time', text: '–°–µ–º—å—è', icon: icons.FamilyIcon },
                { id: 'daily-habits', text: '–ü—Ä–∏–≤—ã—á–∫–∏', icon: icons.HabitsIcon },
                { id: 'learning-progress', text: '–û–±—É—á–µ–Ω–∏–µ', icon: icons.LearningIcon },
                { id: 'finance', text: '–§–∏–Ω–∞–Ω—Å—ã', icon: icons.FinanceIcon },
                { id: 'schulte-table', text: '–®—É–ª—å—Ç–µ', icon: icons.GamepadIcon },
                { id: 'notebook', text: '–ë–ª–æ–∫–Ω–æ—Ç', icon: icons.NotebookIcon },
                { id: 'ai-assistant', text: 'AI –ü–æ–º–æ—â–Ω–∏–∫', icon: icons.BrainIcon },
            ];

            navTabs.innerHTML = tabs.map(tab => `
                <button
                    id="tab-${tab.id}"
                    data-tab="${tab.id}"
                    class="flex items-center justify-center flex-1 min-w-[120px] py-3 px-4 rounded-full text-lg font-semibold transition-all duration-300 ease-in-out"
                >
                    ${tab.icon} ${tab.text}
                </button>
            `).join('');

            tabs.forEach(tab => {
                document.getElementById(`tab-${tab.id}`).addEventListener('click', () => {
                    activeTab = tab.id;
                    renderApp();
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–æ–∫ –≤–∫–ª–∞–¥–æ–∫
        function updateTabButtons() {
            const navTabs = document.getElementById('nav-tabs');
            navTabs.querySelectorAll('button').forEach(button => {
                if (button.dataset.tab === activeTab) {
                    button.classList.add('bg-amber-600', 'text-white', 'shadow-lg');
                    button.classList.remove('text-gray-300', 'hover:bg-gray-700');
                } else {
                    button.classList.remove('bg-amber-600', 'text-white', 'shadow-lg');
                    button.classList.add('text-gray-300', 'hover:bg-gray-700');
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
        async function initializeFirebaseAndLoadData() {
            try {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
                if (!app) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                }

                // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Firebase
                if (!auth.currentUser) {
                    try {
                        if (typeof __initial_auth_token !== 'undefined') {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("–û—à–∏–±–∫–∞ Firebase –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:", error);
                        showMessageModal("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Firebase. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.");
                    }
                }
                currentUserId = auth.currentUser?.uid || crypto.randomUUID();
                isAuthReady = true;

                document.getElementById('user-id-value').textContent = currentUserId;
                document.getElementById('user-id-display').classList.remove('hidden');
                document.getElementById('logged-in-username-display').textContent = loggedInUsername;

                loadData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                setupTabs(); // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
                renderApp(); // –†–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                setInterval(checkNotifications, 60 * 1000); // –ü—Ä–æ–≤–µ—Ä—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
                showMessageModal("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥–∞
        async function handleLogin() {
            const usernameInput = document.getElementById('login-username');
            const passwordInput = document.getElementById('login-password');
            const errorMessageDisplay = document.getElementById('login-error-message');

            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (userCredentials[username] && userCredentials[username] === password) {
                loggedInUsername = username;
                sessionStorage.setItem('loggedInUsername', loggedInUsername); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥–∏–Ω –≤ —Å–µ—Å—Å–∏–∏
                errorMessageDisplay.classList.add('hidden');
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app-content').classList.remove('hidden');
                await initializeFirebaseAndLoadData();
            } else {
                errorMessageDisplay.classList.remove('hidden');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = async function() {
            loggedInUsername = sessionStorage.getItem('loggedInUsername'); // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ª–æ–≥–∏–Ω
            if (loggedInUsername) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app-content').classList.remove('hidden');
                await initializeFirebaseAndLoadData();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app-content').classList.add('hidden');
            }

            document.getElementById('login-button').onclick = handleLogin;
            document.getElementById('login-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        };
    </script>
</body>
</html>
